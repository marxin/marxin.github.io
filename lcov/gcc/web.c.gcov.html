<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - gcc.info - gcc/web.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">gcc</a> - web.c<span style="font-size: 80%;"> (source / <a href="web.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">gcc.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">163</td>
            <td class="headerCovTableEntry">171</td>
            <td class="headerCovTableEntryHi">95.3 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-09-22 10:58:49</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntry">11</td>
            <td class="headerCovTableEntryMed">81.8 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* Web construction code for GNU compiler.</a>
<span class="lineNum">       2 </span>            :    Contributed by Jan Hubicka.
<span class="lineNum">       3 </span>            :    Copyright (C) 2001-2018 Free Software Foundation, Inc.
<span class="lineNum">       4 </span>            : 
<span class="lineNum">       5 </span>            : This file is part of GCC.
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            : GCC is free software; you can redistribute it and/or modify it under
<span class="lineNum">       8 </span>            : the terms of the GNU General Public License as published by the Free
<span class="lineNum">       9 </span>            : Software Foundation; either version 3, or (at your option) any later
<span class="lineNum">      10 </span>            : version.
<span class="lineNum">      11 </span>            : 
<span class="lineNum">      12 </span>            : GCC is distributed in the hope that it will be useful, but WITHOUT ANY
<span class="lineNum">      13 </span>            : WARRANTY; without even the implied warranty of MERCHANTABILITY or
<span class="lineNum">      14 </span>            : FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
<span class="lineNum">      15 </span>            : for more details.
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : You should have received a copy of the GNU General Public License
<span class="lineNum">      18 </span>            : along with GCC; see the file COPYING3.  If not see
<span class="lineNum">      19 </span>            : &lt;http://www.gnu.org/licenses/&gt;.  */
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : /* Simple optimization pass that splits independent uses of each pseudo,
<span class="lineNum">      22 </span>            :    increasing effectiveness of other optimizations.  The optimization can
<span class="lineNum">      23 </span>            :    serve as an example of use for the dataflow module.
<span class="lineNum">      24 </span>            : 
<span class="lineNum">      25 </span>            :    TODO
<span class="lineNum">      26 </span>            :     - We may use profile information and ignore infrequent use for the
<span class="lineNum">      27 </span>            :       purpose of web unifying, inserting the compensation code later to
<span class="lineNum">      28 </span>            :       implement full induction variable expansion for loops (currently
<span class="lineNum">      29 </span>            :       we expand only if the induction variable is dead afterward, which
<span class="lineNum">      30 </span>            :       is often the case).  */
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : #include &quot;config.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;system.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;coretypes.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;backend.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;rtl.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;df.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;insn-config.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;recog.h&quot;
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            : #include &quot;tree-pass.h&quot;
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : /* Find the root of unionfind tree (the representative of set).  */
<a name="45"><span class="lineNum">      45 </span>            : </a>
<span class="lineNum">      46 </span>            : web_entry_base *
<span class="lineNum">      47 </span><span class="lineCov">   10451488 : web_entry_base::unionfind_root ()</span>
<span class="lineNum">      48 </span>            : {
<span class="lineNum">      49 </span><span class="lineCov">   10451488 :   web_entry_base *element = this, *element1 = this, *element2;</span>
<span class="lineNum">      50 </span>            : 
<span class="lineNum">      51 </span><span class="lineCov">   37256874 :   while (element-&gt;pred ())</span>
<span class="lineNum">      52 </span>            :     element = element-&gt;pred ();
<span class="lineNum">      53 </span><span class="lineCov">   37256874 :   while (element1-&gt;pred ())</span>
<span class="lineNum">      54 </span>            :     {
<span class="lineNum">      55 </span><span class="lineCov">    8176949 :       element2 = element1-&gt;pred ();</span>
<span class="lineNum">      56 </span><span class="lineCov">    8176949 :       element1-&gt;set_pred (element);</span>
<span class="lineNum">      57 </span><span class="lineCov">    8176949 :       element1 = element2;</span>
<span class="lineNum">      58 </span>            :     }
<span class="lineNum">      59 </span><span class="lineCov">   10451488 :   return element;</span>
<span class="lineNum">      60 </span>            : }
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span>            : /* Union sets.
<span class="lineNum">      63 </span>            :    Return true if FIRST and SECOND points to the same web entry structure and
<span class="lineNum">      64 </span>            :    nothing is done.  Otherwise, return false.  */
<a name="65"><span class="lineNum">      65 </span>            : </a>
<span class="lineNum">      66 </span>            : bool
<span class="lineNum">      67 </span><span class="lineCov">    3355301 : unionfind_union (web_entry_base *first, web_entry_base *second)</span>
<span class="lineNum">      68 </span>            : {
<span class="lineNum">      69 </span><span class="lineCov">    3355301 :   first = first-&gt;unionfind_root ();</span>
<span class="lineNum">      70 </span><span class="lineCov">    3355301 :   second = second-&gt;unionfind_root ();</span>
<span class="lineNum">      71 </span><span class="lineCov">    3355301 :   if (first == second)</span>
<span class="lineNum">      72 </span>            :     return true;
<span class="lineNum">      73 </span><span class="lineCov">    2700990 :   second-&gt;set_pred (first);</span>
<span class="lineNum">      74 </span><span class="lineCov">    2700990 :   return false;</span>
<span class="lineNum">      75 </span>            : }
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span>            : class web_entry : public web_entry_base
<span class="lineNum">      78 </span>            : {
<span class="lineNum">      79 </span>            :  private:
<span class="lineNum">      80 </span>            :   rtx reg_pvt;
<a name="81"><span class="lineNum">      81 </span>            : </a>
<a name="82"><span class="lineNum">      82 </span>            :  public:</a>
<span class="lineNum">      83 </span><span class="lineCov">    3740886 :   rtx reg () { return reg_pvt; }</span>
<span class="lineNum">      84 </span><span class="lineCov">    1039896 :   void set_reg (rtx r) { reg_pvt = r; }</span>
<span class="lineNum">      85 </span>            : };
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span>            : /* For INSN, union all defs and uses that are linked by match_dup.
<span class="lineNum">      88 </span>            :    FUN is the function that does the union.  */
<a name="89"><span class="lineNum">      89 </span>            : </a>
<span class="lineNum">      90 </span>            : static void
<span class="lineNum">      91 </span><span class="lineCov">    2362407 : union_match_dups (rtx_insn *insn, web_entry *def_entry, web_entry *use_entry,</span>
<span class="lineNum">      92 </span>            :                   bool (*fun) (web_entry_base *, web_entry_base *))
<span class="lineNum">      93 </span>            : {
<span class="lineNum">      94 </span><span class="lineCov">    2362407 :   struct df_insn_info *insn_info = DF_INSN_INFO_GET (insn);</span>
<span class="lineNum">      95 </span><span class="lineCov">    2362407 :   df_ref use_link = DF_INSN_INFO_USES (insn_info);</span>
<span class="lineNum">      96 </span><span class="lineCov">    2362407 :   df_ref def_link = DF_INSN_INFO_DEFS (insn_info);</span>
<span class="lineNum">      97 </span><span class="lineCov">    2362407 :   struct web_entry *dup_entry;</span>
<span class="lineNum">      98 </span><span class="lineCov">    2362407 :   int i;</span>
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span><span class="lineCov">    2362407 :   extract_insn (insn);</span>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span><span class="lineCov">    2429851 :   for (i = 0; i &lt; recog_data.n_dups; i++)</span>
<span class="lineNum">     103 </span>            :     {
<span class="lineNum">     104 </span><span class="lineCov">      67444 :       int op = recog_data.dup_num[i];</span>
<span class="lineNum">     105 </span><span class="lineCov">      67444 :       enum op_type type = recog_data.operand_type[op];</span>
<span class="lineNum">     106 </span><span class="lineCov">      67444 :       df_ref ref, dupref;</span>
<span class="lineNum">     107 </span><span class="lineCov">      67444 :       struct web_entry *entry;</span>
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span><span class="lineCov">      67444 :       dup_entry = use_entry;</span>
<span class="lineNum">     110 </span><span class="lineCov">     305427 :       for (dupref = use_link; dupref; dupref = DF_REF_NEXT_LOC (dupref))</span>
<span class="lineNum">     111 </span><span class="lineCov">     286478 :         if (DF_REF_LOC (dupref) == recog_data.dup_loc[i])</span>
<span class="lineNum">     112 </span>            :           break;
<span class="lineNum">     113 </span>            : 
<span class="lineNum">     114 </span><span class="lineCov">      67444 :       if (dupref == NULL &amp;&amp; type == OP_INOUT)</span>
<span class="lineNum">     115 </span>            :         {
<span class="lineNum">     116 </span>            :           dup_entry = def_entry;
<span class="lineNum">     117 </span><span class="lineCov">       9047 :           for (dupref = def_link; dupref; dupref = DF_REF_NEXT_LOC (dupref))</span>
<span class="lineNum">     118 </span><span class="lineCov">       5718 :             if (DF_REF_LOC (dupref) == recog_data.dup_loc[i])</span>
<span class="lineNum">     119 </span>            :               break;
<span class="lineNum">     120 </span>            :         }
<span class="lineNum">     121 </span>            :       /* ??? *DUPREF can still be zero, because when an operand matches
<span class="lineNum">     122 </span>            :          a memory, DF_REF_LOC (use_link[n]) points to the register part
<span class="lineNum">     123 </span>            :          of the address, whereas recog_data.dup_loc[m] points to the
<span class="lineNum">     124 </span>            :          entire memory ref, thus we fail to find the duplicate entry,
<span class="lineNum">     125 </span>            :          even though it is there.
<span class="lineNum">     126 </span>            :          Example: i686-pc-linux-gnu gcc.c-torture/compile/950607-1.c
<span class="lineNum">     127 </span>            :                   -O3 -fomit-frame-pointer -funroll-loops  */
<span class="lineNum">     128 </span><span class="lineCov">      67444 :       if (dupref == NULL</span>
<span class="lineNum">     129 </span><span class="lineCov">      48495 :           || DF_REF_REGNO (dupref) &lt; FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     130 </span>            :         continue;
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span><span class="lineCov">      48495 :       ref = type == OP_IN ? use_link : def_link;</span>
<span class="lineNum">     133 </span><span class="lineCov">      48495 :       entry = type == OP_IN ? use_entry : def_entry;</span>
<span class="lineNum">     134 </span><span class="lineCov">     362308 :       for (; ref; ref = DF_REF_NEXT_LOC (ref))</span>
<span class="lineNum">     135 </span>            :         {
<span class="lineNum">     136 </span><span class="lineCov">     362308 :           rtx *l = DF_REF_LOC (ref);</span>
<span class="lineNum">     137 </span><span class="lineCov">     362308 :           if (l == recog_data.operand_loc[op])</span>
<span class="lineNum">     138 </span>            :             break;
<span class="lineNum">     139 </span><span class="lineCov">     313813 :           if (l &amp;&amp; DF_REF_REAL_LOC (ref) == recog_data.operand_loc[op])</span>
<span class="lineNum">     140 </span>            :             break;
<span class="lineNum">     141 </span>            :         }
<span class="lineNum">     142 </span>            : 
<span class="lineNum">     143 </span><span class="lineCov">      48495 :       if (!ref &amp;&amp; type == OP_INOUT)</span>
<span class="lineNum">     144 </span>            :         {
<span class="lineNum">     145 </span>            :           entry = use_entry;
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :           for (ref = use_link; ref; ref = DF_REF_NEXT_LOC (ref))</span>
<span class="lineNum">     147 </span>            :             {
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :               rtx *l = DF_REF_LOC (ref);</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :               if (l == recog_data.operand_loc[op])</span>
<span class="lineNum">     150 </span>            :                 break;
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :               if (l &amp;&amp; DF_REF_REAL_LOC (ref) == recog_data.operand_loc[op])</span>
<span class="lineNum">     152 </span>            :                 break;
<span class="lineNum">     153 </span>            :             }
<span class="lineNum">     154 </span>            :         }
<span class="lineNum">     155 </span>            : 
<span class="lineNum">     156 </span><span class="lineCov">      48495 :       gcc_assert (ref);</span>
<span class="lineNum">     157 </span><span class="lineCov">      48495 :       (*fun) (dup_entry + DF_REF_ID (dupref), entry + DF_REF_ID (ref));</span>
<span class="lineNum">     158 </span>            :     }
<span class="lineNum">     159 </span><span class="lineCov">    2362407 : }</span>
<span class="lineNum">     160 </span>            : 
<span class="lineNum">     161 </span>            : /* For each use, all possible defs reaching it must come in the same
<span class="lineNum">     162 </span>            :    register, union them.
<span class="lineNum">     163 </span>            :    FUN is the function that does the union.
<span class="lineNum">     164 </span>            : 
<span class="lineNum">     165 </span>            :    In USED, we keep the DF_REF_ID of the first uninitialized uses of a
<span class="lineNum">     166 </span>            :    register, so that all uninitialized uses of the register can be
<span class="lineNum">     167 </span>            :    combined into a single web.  We actually offset it by 2, because
<span class="lineNum">     168 </span>            :    the values 0 and 1 are reserved for use by entry_register.  */
<a name="169"><span class="lineNum">     169 </span>            : </a>
<span class="lineNum">     170 </span>            : void
<span class="lineNum">     171 </span><span class="lineCov">    2510062 : union_defs (df_ref use, web_entry *def_entry,</span>
<span class="lineNum">     172 </span>            :             unsigned int *used, web_entry *use_entry,
<span class="lineNum">     173 </span>            :             bool (*fun) (web_entry_base *, web_entry_base *))
<span class="lineNum">     174 </span>            : {
<span class="lineNum">     175 </span><span class="lineCov">    2510062 :   struct df_insn_info *insn_info = DF_REF_INSN_INFO (use);</span>
<span class="lineNum">     176 </span><span class="lineCov">    2510062 :   struct df_link *link = DF_REF_CHAIN (use);</span>
<span class="lineNum">     177 </span><span class="lineCov">    2510062 :   rtx set;</span>
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span><span class="lineCov">    2510062 :   if (insn_info)</span>
<span class="lineNum">     180 </span>            :     {
<span class="lineNum">     181 </span><span class="lineCov">    2510062 :       df_ref eq_use;</span>
<span class="lineNum">     182 </span>            : 
<span class="lineNum">     183 </span><span class="lineCov">    2510062 :       set = single_set (insn_info-&gt;insn);</span>
<span class="lineNum">     184 </span><span class="lineCov">    2711437 :       FOR_EACH_INSN_INFO_EQ_USE (eq_use, insn_info)</span>
<span class="lineNum">     185 </span><span class="lineCov">     201375 :         if (use != eq_use</span>
<span class="lineNum">     186 </span><span class="lineCov">     157120 :             &amp;&amp; DF_REF_REAL_REG (use) == DF_REF_REAL_REG (eq_use))</span>
<span class="lineNum">     187 </span><span class="lineCov">      32567 :           (*fun) (use_entry + DF_REF_ID (use), use_entry + DF_REF_ID (eq_use));</span>
<span class="lineNum">     188 </span>            :     }
<span class="lineNum">     189 </span>            :   else
<span class="lineNum">     190 </span>            :     set = NULL;
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            :   /* Union all occurrences of the same register in reg notes.  */
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            :   /* Recognize trivial noop moves and attempt to keep them as noop.  */
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span><span class="lineCov">    2510062 :   if (set</span>
<span class="lineNum">     197 </span><span class="lineCov">    2502269 :       &amp;&amp; SET_SRC (set) == DF_REF_REG (use)</span>
<span class="lineNum">     198 </span><span class="lineCov">     377256 :       &amp;&amp; SET_SRC (set) == SET_DEST (set))</span>
<span class="lineNum">     199 </span>            :     {
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :       df_ref def;</span>
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :       FOR_EACH_INSN_INFO_DEF (def, insn_info)</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :         if (DF_REF_REAL_REG (use) == DF_REF_REAL_REG (def))</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :           (*fun) (use_entry + DF_REF_ID (use), def_entry + DF_REF_ID (def));</span>
<span class="lineNum">     205 </span>            :     }
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            :   /* UD chains of uninitialized REGs are empty.  Keeping all uses of
<span class="lineNum">     208 </span>            :      the same uninitialized REG in a single web is not necessary for
<span class="lineNum">     209 </span>            :      correctness, since the uses are undefined, but it's wasteful to
<span class="lineNum">     210 </span>            :      allocate one register or slot for each reference.  Furthermore,
<span class="lineNum">     211 </span>            :      creating new pseudos for uninitialized references in debug insns
<span class="lineNum">     212 </span>            :      (see PR 42631) causes -fcompare-debug failures.  We record the
<span class="lineNum">     213 </span>            :      number of the first uninitialized reference we found, and merge
<span class="lineNum">     214 </span>            :      with it any other uninitialized references to the same
<span class="lineNum">     215 </span>            :      register.  */
<span class="lineNum">     216 </span><span class="lineCov">    2510062 :   if (!link)</span>
<span class="lineNum">     217 </span>            :     {
<span class="lineNum">     218 </span><span class="lineCov">       8977 :       int regno = REGNO (DF_REF_REAL_REG (use));</span>
<span class="lineNum">     219 </span><span class="lineCov">       8977 :       if (used[regno])</span>
<span class="lineNum">     220 </span><span class="lineCov">       6106 :         (*fun) (use_entry + DF_REF_ID (use), use_entry + used[regno] - 2);</span>
<span class="lineNum">     221 </span>            :       else
<span class="lineNum">     222 </span><span class="lineCov">       2871 :         used[regno] = DF_REF_ID (use) + 2;</span>
<span class="lineNum">     223 </span>            :     }
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span><span class="lineCov">    5774311 :   while (link)</span>
<span class="lineNum">     226 </span>            :     {
<span class="lineNum">     227 </span><span class="lineCov">    6528498 :       (*fun) (use_entry + DF_REF_ID (use),</span>
<span class="lineNum">     228 </span><span class="lineCov">    3264249 :               def_entry + DF_REF_ID (link-&gt;ref));</span>
<span class="lineNum">     229 </span><span class="lineCov">    3264249 :       link = link-&gt;next;</span>
<span class="lineNum">     230 </span>            :     }
<span class="lineNum">     231 </span>            : 
<span class="lineNum">     232 </span>            :   /* A READ_WRITE use requires the corresponding def to be in the same
<span class="lineNum">     233 </span>            :      register.  Find it and union.  */
<span class="lineNum">     234 </span><span class="lineCov">    2510062 :   if (DF_REF_FLAGS (use) &amp; DF_REF_READ_WRITE)</span>
<span class="lineNum">     235 </span><span class="lineCov">       3884 :     if (insn_info)</span>
<span class="lineNum">     236 </span>            :       {
<span class="lineNum">     237 </span><span class="lineCov">       3884 :         df_ref def;</span>
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span><span class="lineCov">       7782 :         FOR_EACH_INSN_INFO_DEF (def, insn_info)</span>
<span class="lineNum">     240 </span><span class="lineCov">       3898 :           if (DF_REF_REAL_REG (use) == DF_REF_REAL_REG (def))</span>
<span class="lineNum">     241 </span><span class="lineCov">       3884 :             (*fun) (use_entry + DF_REF_ID (use), def_entry + DF_REF_ID (def));</span>
<span class="lineNum">     242 </span>            :       }
<span class="lineNum">     243 </span><span class="lineCov">    2510062 : }</span>
<span class="lineNum">     244 </span>            : 
<span class="lineNum">     245 </span>            : /* Find the corresponding register for the given entry.  */
<a name="246"><span class="lineNum">     246 </span>            : </a>
<span class="lineNum">     247 </span>            : static rtx
<span class="lineNum">     248 </span><span class="lineCov">    3740886 : entry_register (web_entry *entry, df_ref ref, unsigned int *used)</span>
<span class="lineNum">     249 </span>            : {
<span class="lineNum">     250 </span><span class="lineCov">    3740886 :   web_entry *root;</span>
<span class="lineNum">     251 </span><span class="lineCov">    3740886 :   rtx reg, newreg;</span>
<span class="lineNum">     252 </span>            : 
<span class="lineNum">     253 </span>            :   /* Find the corresponding web and see if it has been visited.  */
<span class="lineNum">     254 </span><span class="lineCov">    3740886 :   root = (web_entry *)entry-&gt;unionfind_root ();</span>
<span class="lineNum">     255 </span><span class="lineCov">    3740886 :   if (root-&gt;reg ())</span>
<span class="lineNum">     256 </span>            :     return root-&gt;reg ();
<span class="lineNum">     257 </span>            : 
<span class="lineNum">     258 </span>            :   /* We are seeing this web for the first time, do the assignment.  */
<span class="lineNum">     259 </span><span class="lineCov">    1039896 :   reg = DF_REF_REAL_REG (ref);</span>
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span>            :   /* In case the original register is already assigned, generate new
<span class="lineNum">     262 </span>            :      one.  Since we use USED to merge uninitialized refs into a single
<span class="lineNum">     263 </span>            :      web, we might found an element to be nonzero without our having
<span class="lineNum">     264 </span>            :      used it.  Test for 1, because union_defs saves it for our use,
<span class="lineNum">     265 </span>            :      and there won't be any use for the other values when we get to
<span class="lineNum">     266 </span>            :      this point.  */
<span class="lineNum">     267 </span><span class="lineCov">    2079792 :   if (used[REGNO (reg)] != 1)</span>
<span class="lineNum">     268 </span><span class="lineCov">    1493782 :     newreg = reg, used[REGNO (reg)] = 1;</span>
<span class="lineNum">     269 </span>            :   else
<span class="lineNum">     270 </span>            :     {
<span class="lineNum">     271 </span><span class="lineCov">     293005 :       newreg = gen_reg_rtx (GET_MODE (reg));</span>
<span class="lineNum">     272 </span><span class="lineCov">     293005 :       REG_USERVAR_P (newreg) = REG_USERVAR_P (reg);</span>
<span class="lineNum">     273 </span><span class="lineCov">     293005 :       REG_POINTER (newreg) = REG_POINTER (reg);</span>
<span class="lineNum">     274 </span><span class="lineCov">     293005 :       REG_ATTRS (newreg) = REG_ATTRS (reg);</span>
<span class="lineNum">     275 </span><span class="lineCov">     293005 :       if (dump_file)</span>
<span class="lineNum">     276 </span><span class="lineCov">        438 :         fprintf (dump_file, &quot;Web oldreg=%i newreg=%i\n&quot;, REGNO (reg),</span>
<span class="lineNum">     277 </span>            :                  REGNO (newreg));
<span class="lineNum">     278 </span>            :     }
<span class="lineNum">     279 </span>            : 
<span class="lineNum">     280 </span><span class="lineCov">    2079792 :   root-&gt;set_reg (newreg);</span>
<span class="lineNum">     281 </span><span class="lineCov">    1039896 :   return newreg;</span>
<span class="lineNum">     282 </span>            : }
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span>            : /* Replace the reference by REG.  */
<a name="285"><span class="lineNum">     285 </span>            : </a>
<span class="lineNum">     286 </span>            : static void
<span class="lineNum">     287 </span><span class="lineCov">    3740886 : replace_ref (df_ref ref, rtx reg)</span>
<span class="lineNum">     288 </span>            : {
<span class="lineNum">     289 </span><span class="lineCov">    3740886 :   rtx oldreg = DF_REF_REAL_REG (ref);</span>
<span class="lineNum">     290 </span><span class="lineCov">    3740886 :   rtx *loc = DF_REF_REAL_LOC (ref);</span>
<span class="lineNum">     291 </span><span class="lineCov">    3740886 :   unsigned int uid = DF_REF_INSN_UID (ref);</span>
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span><span class="lineCov">    3740886 :   if (oldreg == reg)</span>
<span class="lineNum">     294 </span>            :     return;
<span class="lineNum">     295 </span><span class="lineCov">     789762 :   if (dump_file)</span>
<span class="lineNum">     296 </span><span class="lineCov">       1284 :     fprintf (dump_file, &quot;Updating insn %i (%i-&gt;%i)\n&quot;,</span>
<span class="lineNum">     297 </span>            :              uid, REGNO (oldreg), REGNO (reg));
<span class="lineNum">     298 </span><span class="lineCov">     789762 :   *loc = reg;</span>
<span class="lineNum">     299 </span><span class="lineCov">     789762 :   df_insn_rescan (DF_REF_INSN (ref));</span>
<span class="lineNum">     300 </span>            : }
<span class="lineNum">     301 </span>            : 
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span>            : namespace {
<span class="lineNum">     304 </span>            : 
<span class="lineNum">     305 </span>            : const pass_data pass_data_web =
<span class="lineNum">     306 </span>            : {
<span class="lineNum">     307 </span>            :   RTL_PASS, /* type */
<span class="lineNum">     308 </span>            :   &quot;web&quot;, /* name */
<span class="lineNum">     309 </span>            :   OPTGROUP_NONE, /* optinfo_flags */
<span class="lineNum">     310 </span>            :   TV_WEB, /* tv_id */
<span class="lineNum">     311 </span>            :   0, /* properties_required */
<span class="lineNum">     312 </span>            :   0, /* properties_provided */
<span class="lineNum">     313 </span>            :   0, /* properties_destroyed */
<span class="lineNum">     314 </span>            :   0, /* todo_flags_start */
<span class="lineNum">     315 </span>            :   TODO_df_finish, /* todo_flags_finish */
<span class="lineNum">     316 </span>            : };
<span class="lineNum">     317 </span>            : 
<span class="lineNum">     318 </span>            : class pass_web : public rtl_opt_pass
<span class="lineNum">     319 </span>            : {
<span class="lineNum">     320 </span>            : public:
<span class="lineNum">     321 </span>            :   pass_web (gcc::context *ctxt)
<span class="lineNum">     322 </span><span class="lineCov">     340624 :     : rtl_opt_pass (pass_data_web, ctxt)</span>
<span class="lineNum">     323 </span>            :   {}
<a name="324"><span class="lineNum">     324 </span>            : </a>
<span class="lineNum">     325 </span>            :   /* opt_pass methods: */
<span class="lineNum">     326 </span><span class="lineCov">     832594 :   virtual bool gate (function *) { return (optimize &gt; 0 &amp;&amp; flag_web); }</span>
<span class="lineNum">     327 </span>            :   virtual unsigned int execute (function *);
<span class="lineNum">     328 </span>            : 
<span class="lineNum">     329 </span>            : }; // class pass_web
<a name="330"><span class="lineNum">     330 </span>            : </a>
<span class="lineNum">     331 </span>            : unsigned int
<span class="lineNum">     332 </span><span class="lineCov">      14429 : pass_web::execute (function *fun)</span>
<span class="lineNum">     333 </span>            : {
<span class="lineNum">     334 </span><span class="lineCov">      14429 :   web_entry *def_entry;</span>
<span class="lineNum">     335 </span><span class="lineCov">      14429 :   web_entry *use_entry;</span>
<span class="lineNum">     336 </span><span class="lineCov">      14429 :   unsigned int max = max_reg_num ();</span>
<span class="lineNum">     337 </span><span class="lineCov">      14429 :   unsigned int *used;</span>
<span class="lineNum">     338 </span><span class="lineCov">      14429 :   basic_block bb;</span>
<span class="lineNum">     339 </span><span class="lineCov">      14429 :   unsigned int uses_num = 0;</span>
<span class="lineNum">     340 </span><span class="lineCov">      14429 :   rtx_insn *insn;</span>
<span class="lineNum">     341 </span>            : 
<span class="lineNum">     342 </span><span class="lineCov">      14429 :   df_set_flags (DF_NO_HARD_REGS + DF_EQ_NOTES);</span>
<span class="lineNum">     343 </span><span class="lineCov">      14429 :   df_set_flags (DF_RD_PRUNE_DEAD_DEFS);</span>
<span class="lineNum">     344 </span><span class="lineCov">      14429 :   df_chain_add_problem (DF_UD_CHAIN);</span>
<span class="lineNum">     345 </span><span class="lineCov">      14429 :   df_analyze ();</span>
<span class="lineNum">     346 </span><span class="lineCov">      14429 :   df_set_flags (DF_DEFER_INSN_RESCAN);</span>
<span class="lineNum">     347 </span>            : 
<span class="lineNum">     348 </span>            :   /* Assign ids to the uses.  */
<span class="lineNum">     349 </span><span class="lineCov">     370772 :   FOR_ALL_BB_FN (bb, fun)</span>
<span class="lineNum">     350 </span><span class="lineCov">    7014137 :     FOR_BB_INSNS (bb, insn)</span>
<span class="lineNum">     351 </span>            :     {
<span class="lineNum">     352 </span><span class="lineCov">    3328897 :       if (NONDEBUG_INSN_P (insn))</span>
<span class="lineNum">     353 </span>            :         {
<span class="lineNum">     354 </span><span class="lineCov">    2362407 :           struct df_insn_info *insn_info = DF_INSN_INFO_GET (insn);</span>
<span class="lineNum">     355 </span><span class="lineCov">    2362407 :           df_ref use;</span>
<span class="lineNum">     356 </span><span class="lineCov">    5673479 :           FOR_EACH_INSN_INFO_USE (use, insn_info)</span>
<span class="lineNum">     357 </span><span class="lineCov">    3311072 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     358 </span><span class="lineCov">    2465807 :               DF_REF_ID (use) = uses_num++;</span>
<span class="lineNum">     359 </span><span class="lineCov">    2458989 :           FOR_EACH_INSN_INFO_EQ_USE (use, insn_info)</span>
<span class="lineNum">     360 </span><span class="lineCov">      96582 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     361 </span><span class="lineCov">      44255 :               DF_REF_ID (use) = uses_num++;</span>
<span class="lineNum">     362 </span>            :         }
<span class="lineNum">     363 </span>            :     }
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span>            :   /* Record the number of uses and defs at the beginning of the optimization.  */
<span class="lineNum">     366 </span><span class="lineCov">      14429 :   def_entry = XCNEWVEC (web_entry, DF_DEFS_TABLE_SIZE ());</span>
<span class="lineNum">     367 </span><span class="lineCov">      14429 :   used = XCNEWVEC (unsigned, max);</span>
<span class="lineNum">     368 </span><span class="lineCov">      14429 :   use_entry = XCNEWVEC (web_entry, uses_num);</span>
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span>            :   /* Produce the web.  */
<span class="lineNum">     371 </span><span class="lineCov">     370772 :   FOR_ALL_BB_FN (bb, fun)</span>
<span class="lineNum">     372 </span><span class="lineCov">    7014137 :     FOR_BB_INSNS (bb, insn)</span>
<span class="lineNum">     373 </span><span class="lineCov">    3328897 :       if (NONDEBUG_INSN_P (insn))</span>
<span class="lineNum">     374 </span>            :         {
<span class="lineNum">     375 </span><span class="lineCov">    2362407 :           struct df_insn_info *insn_info = DF_INSN_INFO_GET (insn);</span>
<span class="lineNum">     376 </span><span class="lineCov">    2362407 :           df_ref use;</span>
<span class="lineNum">     377 </span><span class="lineCov">    2362407 :           union_match_dups (insn, def_entry, use_entry, unionfind_union);</span>
<span class="lineNum">     378 </span><span class="lineCov">    5673479 :           FOR_EACH_INSN_INFO_USE (use, insn_info)</span>
<span class="lineNum">     379 </span><span class="lineCov">    3311072 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     380 </span><span class="lineCov">    2465807 :               union_defs (use, def_entry, used, use_entry, unionfind_union);</span>
<span class="lineNum">     381 </span><span class="lineCov">    2458989 :           FOR_EACH_INSN_INFO_EQ_USE (use, insn_info)</span>
<span class="lineNum">     382 </span><span class="lineCov">      96582 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     383 </span><span class="lineCov">      44255 :               union_defs (use, def_entry, used, use_entry, unionfind_union);</span>
<span class="lineNum">     384 </span>            :         }
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span>            :   /* Update the instruction stream, allocating new registers for split pseudos
<span class="lineNum">     387 </span>            :      in progress.  */
<span class="lineNum">     388 </span><span class="lineCov">     370772 :   FOR_ALL_BB_FN (bb, fun)</span>
<span class="lineNum">     389 </span><span class="lineCov">    7014137 :     FOR_BB_INSNS (bb, insn)</span>
<span class="lineNum">     390 </span><span class="lineCov">    3328897 :       if (NONDEBUG_INSN_P (insn)</span>
<span class="lineNum">     391 </span>            :           /* Ignore naked clobber.  For example, reg 134 in the second insn
<span class="lineNum">     392 </span>            :              of the following sequence will not be replaced.
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span>            :                (insn (clobber (reg:SI 134)))
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span>            :                (insn (set (reg:SI 0 r0) (reg:SI 134)))
<span class="lineNum">     397 </span>            : 
<span class="lineNum">     398 </span>            :              Thus the later passes can optimize them away.  */
<span class="lineNum">     399 </span><span class="lineCov">    3328897 :           &amp;&amp; GET_CODE (PATTERN (insn)) != CLOBBER)</span>
<span class="lineNum">     400 </span>            :         {
<span class="lineNum">     401 </span><span class="lineCov">    2361549 :           struct df_insn_info *insn_info = DF_INSN_INFO_GET (insn);</span>
<span class="lineNum">     402 </span><span class="lineCov">    2361549 :           df_ref def, use;</span>
<span class="lineNum">     403 </span><span class="lineCov">    5672518 :           FOR_EACH_INSN_INFO_USE (use, insn_info)</span>
<span class="lineNum">     404 </span><span class="lineCov">    3310969 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     405 </span><span class="lineCov">    2465807 :               replace_ref (use, entry_register (use_entry + DF_REF_ID (use),</span>
<span class="lineNum">     406 </span>            :                                                 use, used));
<span class="lineNum">     407 </span><span class="lineCov">    2458131 :           FOR_EACH_INSN_INFO_EQ_USE (use, insn_info)</span>
<span class="lineNum">     408 </span><span class="lineCov">      96582 :             if (DF_REF_REGNO (use) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     409 </span><span class="lineCov">      44255 :               replace_ref (use, entry_register (use_entry + DF_REF_ID (use),</span>
<span class="lineNum">     410 </span>            :                                                 use, used));
<span class="lineNum">     411 </span><span class="lineCov">   10821234 :           FOR_EACH_INSN_INFO_DEF (def, insn_info)</span>
<span class="lineNum">     412 </span><span class="lineCov">    8459685 :             if (DF_REF_REGNO (def) &gt;= FIRST_PSEUDO_REGISTER)</span>
<span class="lineNum">     413 </span><span class="lineCov">    1230824 :               replace_ref (def, entry_register (def_entry + DF_REF_ID (def),</span>
<span class="lineNum">     414 </span>            :                                                 def, used));
<span class="lineNum">     415 </span>            :         }
<span class="lineNum">     416 </span>            : 
<span class="lineNum">     417 </span><span class="lineCov">      14429 :   free (def_entry);</span>
<span class="lineNum">     418 </span><span class="lineCov">      14429 :   free (use_entry);</span>
<span class="lineNum">     419 </span><span class="lineCov">      14429 :   free (used);</span>
<span class="lineNum">     420 </span><span class="lineCov">      14429 :   return 0;</span>
<span class="lineNum">     421 </span>            : }
<span class="lineNum">     422 </span>            : 
<span class="lineNum">     423 </span>            : } // anon namespace
<a name="424"><span class="lineNum">     424 </span>            : </a>
<span class="lineNum">     425 </span>            : rtl_opt_pass *
<span class="lineNum">     426 </span><span class="lineCov">     170312 : make_pass_web (gcc::context *ctxt)</span>
<span class="lineNum">     427 </span>            : {
<span class="lineNum">     428 </span><span class="lineCov">     170312 :   return new pass_web (ctxt);</span>
<span class="lineNum">     429 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.0</a></td></tr>
  </table>
  <br>
<h3>LCOV profile is generated on x86_64 machine using following configure options: configure --disable-bootstrap --enable-coverage=opt --enable-languages=c,c++,fortran,go,jit,lto --enable-host-shared. GCC test suite is run with the built compiler.</h3></body></html>
